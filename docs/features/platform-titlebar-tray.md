# 平台自适应标题栏与系统托盘

## 功能概述

本应用支持 Mac 和 Windows 平台的原生窗口控件样式，并提供系统托盘功能。

## 平台适配

### macOS
- **窗口控件位置**：左上角
- **按钮样式**：圆形彩色按钮（红、黄、绿）
- **按钮顺序**：关闭、最小化、最大化
- **标题位置**：居中显示

### Windows / Linux
- **窗口控件位置**：右上角
- **按钮样式**：图标按钮
- **按钮顺序**：最小化、最大化、关闭
- **标题位置**：左侧显示

## 系统托盘功能

### 基本功能
- 应用启动时自动创建系统托盘图标
- 点击关闭按钮时，窗口隐藏到托盘而非退出
- 左键点击托盘图标可切换窗口显示/隐藏

### 托盘菜单
右键点击托盘图标显示菜单：
- **显示窗口 / Show**：显示并聚焦主窗口
- **隐藏窗口 / Hide**：隐藏主窗口到托盘
- **退出 / Quit**：完全退出应用

## 技术实现

### 前端
- `src/lib/platform.ts`：平台检测工具
  - 使用 `@tauri-apps/plugin-os` 进行平台检测
  - 提供缓存机制以提高性能
  - 导出 `getPlatform()`, `isMacOS()`, `isWindows()` 等辅助函数

- `src/components/WindowControls.tsx`：平台适配的窗口控件
  - macOS 风格：圆形彩色按钮（红色关闭、黄色最小化、绿色最大化）
  - Windows/Linux 风格：图标按钮（Minus、Square、X 图标）
  - 使用 `lucide-react` 图标库
  - 支持 hover 效果和过渡动画

- `src/App.tsx`：响应式 Header 布局
  - 根据平台动态调整标题和控件位置
  - macOS：控件在左，标题居中
  - Windows/Linux：控件在右，标题在左

### 后端
- `src-tauri/src/lib.rs`：系统托盘实现
  - 使用 `tauri-plugin-tray` 实现托盘功能
  - 托盘图标使用应用默认窗口图标
  - 托盘菜单支持显示/隐藏/退出功能
  - 左键点击托盘图标切换窗口可见性
  - 右键点击显示上下文菜单
  - 窗口关闭事件被拦截，改为隐藏到托盘

- 依赖插件：
  - `tauri-plugin-tray`：系统托盘功能
  - `tauri-plugin-os`：平台检测

## 测试清单

### macOS 测试
- [ ] 窗口控件显示在左上角
- [ ] 按钮为圆形彩色样式（红、黄、绿）
- [ ] 标题居中显示
- [ ] 托盘图标正常显示
- [ ] 左键点击托盘切换窗口显示/隐藏
- [ ] 右键菜单功能正常
- [ ] 点击"显示窗口 / Show"菜单项，窗口显示并获得焦点
- [ ] 点击"隐藏窗口 / Hide"菜单项，窗口隐藏
- [ ] 点击"退出 / Quit"菜单项，应用完全退出
- [ ] 关闭按钮隐藏窗口到托盘而非退出应用

### Windows 测试
- [ ] 窗口控件显示在右上角
- [ ] 按钮为图标样式（Minus、Square、X）
- [ ] 标题在左侧显示
- [ ] 托盘图标正常显示在系统托盘
- [ ] 左键点击托盘切换窗口显示/隐藏
- [ ] 右键菜单功能正常
- [ ] 点击"显示窗口 / Show"菜单项，窗口显示并获得焦点
- [ ] 点击"隐藏窗口 / Hide"菜单项，窗口隐藏
- [ ] 点击"退出 / Quit"菜单项，应用完全退出
- [ ] 点击关闭按钮，窗口隐藏但应用未退出（托盘图标仍在）
- [ ] 最小化、最大化按钮功能正常

### Linux 测试
- [ ] 窗口控件显示在右上角（使用 Windows 样式）
- [ ] 按钮为图标样式
- [ ] 标题在左侧显示
- [ ] 托盘图标正常显示
- [ ] 左键点击托盘切换窗口
- [ ] 右键菜单功能正常
- [ ] 关闭按钮隐藏窗口到托盘

## 已知限制

1. **托盘菜单国际化**：托盘菜单文本为固定的中英文双语（"显示窗口 / Show"），未完全集成 i18next。这是因为托盘菜单在后端 Rust 代码中创建，目前采用简化的双语方案。
2. **Linux 平台样式**：Linux 平台使用 Windows 样式的控件布局，未针对不同桌面环境（GNOME、KDE 等）做特殊适配。
3. **平台检测缓存**：平台检测结果会被缓存，在应用运行期间不会重新检测。这通常不是问题，但在某些特殊场景下可能需要注意。

## 未来改进方向

1. 完全集成托盘菜单的国际化，支持从前端传递语言设置到后端
2. 针对不同 Linux 桌面环境提供更精细的样式适配
3. 添加托盘图标的通知徽章功能
4. 支持自定义托盘菜单项
5. 添加托盘通知功能（气泡提示）
