# 导航结构重构设计方案

> 日期：2026-01-20
> 状态：待实施

## 一、背景与问题

当前存在以下问题：

1. **Marketplace 无法管理** - 用户没有入口卸载已安装的 Marketplace
2. **用户流程过长** - 从精选仓库添加后，需切换到技能市场才能安装，路径过长
3. **自定义仓库入口** - 仓库配置支持自定义仓库，需保留
4. **Skills/Plugins 区分** - 需要明确区分但又不增加认知负担

## 二、设计原则

**按用户任务组织，而非按技术分类**

用户的心智模型：
- "我想**找**能用的东西" → 市场
- "我想**管**已有的东西" → 已安装
- "我想**配**数据来源" → 仓库

## 三、导航结构改造

### 改造前（6个入口）

```
概览 | 我的技能 | 技能市场 | 精选仓库 | 仓库配置 | 设置
```

### 改造后（5个入口）

```
概览 | 市场 | 已安装 | 仓库 | 设置
```

### 各页面职责

| 页面 | 内部结构 | 核心功能 |
|-----|---------|---------|
| **概览** | 保持不变 | 统计卡片、问题列表、快速入口 |
| **市场** | Tab：全部 / 技能 / 插件 | 浏览、搜索、筛选、安装 |
| **已安装** | Tab：技能 / 插件 / Marketplace | 查看、更新、卸载、Marketplace管理 |
| **仓库** | Tab：精选推荐 / 我的仓库 | 添加仓库、扫描、缓存管理 |
| **设置** | 保持不变 | 应用配置 |

## 四、市场页面设计

### 顶部区域

```
[搜索框________________________] [仓库筛选 ▼] [刷新]

Tab: [ 全部 (128) ] [ 技能 (96) ] [ 插件 (32) ]
```

### 卡片展示

每个卡片显示：
- 名称 + 类型标签（`技能` 蓝色 / `插件` 紫色）
- 描述（2行截断）
- 来源仓库
- 安全评分徽章
- 操作按钮：`安装` / `已安装 ✓`

### 筛选逻辑

| Tab | 显示内容 |
|-----|---------|
| 全部 | Skills + Plugins 混合，按名称排序 |
| 技能 | 仅显示 Skills |
| 插件 | 仅显示 Plugins |

### 类型标签视觉区分

- 技能：蓝色标签 `技能`
- 插件：紫色标签 `插件`

卡片右上角始终显示类型标签，用户在"全部"Tab下也能快速识别类型。

## 五、已安装页面设计

### 顶部区域

```
Tab: [ 技能 (12) ] [ 插件 (5) ] [ Marketplace (2) ]

[检查更新]
```

### 技能 Tab

- 显示所有已安装的 Skills
- 每个卡片：名称、安装路径（支持多路径）、版本/commit、安全评分
- 操作：`卸载` / `更新`（有新版本时）

### 插件 Tab

- 显示所有已安装的 Plugins
- 每个卡片：名称、所属 Marketplace、版本
- 操作：`卸载`（调用 `claude plugin uninstall`）

### Marketplace Tab（新增）

- 显示所有已安装的 Marketplace
- 每个卡片：
  - Marketplace 名称
  - 来源仓库
  - 包含的插件数量（已安装 / 总数）
  - 操作：`移除`（调用 `claude plugin marketplace remove`）

### Marketplace 移除逻辑

- 移除前检查是否有已安装的插件依赖此 Marketplace
- 如有依赖，弹窗提示"将同时卸载以下插件：xxx"
- 用户确认后批量卸载

## 六、仓库页面设计

### 顶部区域

```
Tab: [ 精选推荐 ] [ 我的仓库 (5) ]

[清理全部缓存]
```

### 精选推荐 Tab

- 按分类展示精选仓库（AI/Assistant、Productivity 等）
- 每个仓库卡片：名称、描述、Star数、`添加` 按钮
- 已添加的显示 `已添加 ✓`

### 添加仓库后的关键改进（解决路径过长）

点击 `添加` 后：
1. 自动添加仓库到"我的仓库"
2. 自动触发扫描
3. **弹出"仓库内容预览"弹窗**：

```
┌─────────────────────────────────────────────┐
│  ✓ 已添加仓库：anthropics/skills            │
│                                             │
│  发现以下内容：                              │
│  ┌─────────────────────────────────────┐   │
│  │ 🔵 技能  code-review     [安装]     │   │
│  │ 🔵 技能  commit-helper   [安装]     │   │
│  │ 🟣 插件  markdown-tools  [安装]     │   │
│  └─────────────────────────────────────┘   │
│                                             │
│        [前往市场查看全部]    [关闭]          │
└─────────────────────────────────────────────┘
```

用户可直接在弹窗中安装，无需跳转。

### 我的仓库 Tab

- 显示已添加的所有仓库
- 支持添加自定义仓库（输入 GitHub URL）
- 每个仓库卡片：名称、URL、缓存状态、最后扫描时间
- 操作：`扫描` / `清理缓存` / `删除`

## 七、问题解决对照

| 问题 | 解决方案 |
|-----|---------|
| 1. Marketplace无法管理 | 已安装页面新增"Marketplace"Tab，支持查看和移除 |
| 2. 添加仓库后路径过长 | 添加仓库后弹出内容预览，支持直接安装 |
| 3. 自定义仓库必要性 | 保留，放在"仓库 → 我的仓库"Tab中 |
| 4. Skills/Plugins是否分开 | 明确区分但不拆分页面，通过Tab+类型标签区分 |

## 八、代码改动范围

| 模块 | 改动 |
|-----|------|
| 前端导航 | 修改 App.tsx 路由和侧边栏 |
| MarketplacePage | 改造为统一市场，增加类型Tab |
| InstalledSkillsPage | 重命名+增加Marketplace Tab |
| RepositoriesPage | 合并精选仓库，增加弹窗预览组件 |
| FeaturedRepositoriesPage | 删除，合并到仓库页面 |
| 后端 | 基本不变，已有所需API |

## 九、实施顺序建议

1. **阶段一：导航重构**
   - 修改侧边栏导航
   - 调整路由配置
   - 重命名页面组件

2. **阶段二：市场页面改造**
   - 添加类型Tab
   - 添加类型标签到卡片
   - 调整筛选逻辑

3. **阶段三：已安装页面改造**
   - 重命名为"已安装"
   - 添加Marketplace Tab
   - 实现Marketplace移除功能

4. **阶段四：仓库页面改造**
   - 合并精选仓库
   - 实现添加后预览弹窗
   - 支持弹窗内直接安装

5. **阶段五：清理**
   - 删除废弃的FeaturedRepositoriesPage
   - 更新国际化文件
   - 测试验收
